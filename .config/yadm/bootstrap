#!/bin/sh
# Requirements: yadm installed, user added to wheel group and NetworkManager installed and enabled.
#
# https:⁄⁄github.com⁄XxAcielxX⁄arch-plasma-install#login-as-user
# http:⁄⁄tim.theenchanter.com⁄

command_exists() {
    type "$1" &> /dev/null ;
}

cd $HOME
echo ">>> Updating submodules"
yadm submodule update --recursive --init


# Install yay
if ! command_exists yay; then
    echo ">>> Installing yay"
    sudo pacman -S --noconfirm --needed git base-devel && git clone https://aur.archlinux.org/yay-bin.git && cd yay-bin && makepkg -si --noconfirm && cd $HOME && rm -rf yay-bin
fi
yay -Syu --noconfirm

base=(
    "kitty"
    "zsh"
    "neovim"
    "emacs"
    "xclip"
    "ripgrep"
    "fd"
)

window=(
    # "alsa-utils"
    "xorg"
    "xorg-server"
    "nvidia"
    "nvidia-utils"
    "nvidia-settings"
    "sddm"
    "plasma"
    "dolphin"
    "ark"
    "partitionmanager"
)

apps=(
    "bitwarden"
    "discord"
    "gimp"
    "phonon-qt5-vlc"
)

vm=(
    "virtualbox-host-modules-arch"
    "virtualbox"
    "virtualbox-guest-iso"
)

programming=(
    "npm"
    "gcc"
    "python-pip"
)

packages=(
    ${base[@]}
    ${apps[@]}
    ${window[@]}
    ${vm[@]}
    ${programming[@]}
)

aur_packages=(
    "nerd-fonts-source-code-pro"
    "nerd-fonts-jetbrains-mono"
    "github-cli"
    "antigen-git"
    "brave-bin"
    "pcloud-drive"
)

yay -S --noconfirm --needed --noprovides --cleanafter --nodiffmenu ${packages[@]}
yay -S --noconfirm --needed --noprovides --cleanafter --nodiffmenu ${aur_packages[@]}

# Enable services
sudo systemctl enable sddm

# Change shell
chsh

Setup doom-emacs
if [ ! -d "$HOME/.config/emacs" ]; then
    git clone https://github.com/hlissner/doom-emacs ~/.config/emacs
    ~/.config/emacs/bin/doom install
fi

# Setup VirtualBox
sudo modprobe vboxdrv
sudo usermod -aG vboxusers $USER
