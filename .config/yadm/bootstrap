#!/bin/sh
# Requirements: yadm installed, user added to wheel group and networkmanager installed and enabled.
#
# https:⁄⁄github.com⁄XxAcielxX⁄arch-plasma-install#login-as-user
# http:⁄⁄tim.theenchanter.com⁄

command_exists() {
    type "$1" &> /dev/null ;
}

cd $HOME
echo ">>> Updating submodules"
yadm submodule update --recursive --init


# Install yay
if ! command_exists yay; then
    echo ">>> Installing yay"
    sudo pacman -S --noconfirm --needed git base-devel && git clone https://aur.archlinux.org/yay-bin.git && cd yay-bin && makepkg -si --noconfirm && cd $HOME && rm -rf yay-bin
fi
yay -Syu --noconfirm


# Install packages
terminal=(
    "kitty"
    "zsh"
    "antigen"
)

cli_tools=(
    "ripgrep"
    "fd"
    "xclip"
    "github-cli"
)

editor=(
    "neovim"
    "emacs"
)

fonts=(
    "nerd-fonts-source-code-pro"
)

window=(
    "lib32-mesa" # This package is required by Steam if you play games using Vulkan Backend.
    "alsa-utils"
    "xorg"
    "nvidia"
    "nvidia-utils"
    "nvidia-settings"
    "sddm"
    "plasma"
    "dolphin"
    "ark"
    "partitionmanager"
)

apps=(
    "phonon-qt5-vlc"
    "bitwarden"
    "pcloud-drive"
    "discord"
    "gimp"
    "brave-bin"
)

vm=(
    "virtualbox-host-modules-arch"
    "virtualbox"
    "virtualbox-guest-iso"
)

programming=(
    "npm"
    # "python-pip"
    "gcc"
)

packages=(
    ${terminal[@]}
    ${cli_tools[@]}
    ${editor[@]}
    ${fonts[@]}
    ${window[@]}
    ${apps[@]}
    ${vm[@]}
    ${programming[@]}
)
yay -S --noconfirm --needed --noprovides --cleanafter --nodiffmenu ${packages[@]}

# Enable services
sudo systemctl enable sddm

# Change shell
chsh

# Setup doom-emacs
if [ ! -d "$HOME/.config/emacs" ]; then
    git clone https://github.com/hlissner/doom-emacs ~/.config/emacs
    ~/.config/emacs/bin/doom install
fi

# Setup VirtualBox
sudo modprobe vboxdrv
sudo usermod -aG vboxusers $USER

# Kinto
#
# echo "Installing kinto"
# # /bin/bash -c "$(wget -qO- https://raw.githubusercontent.com/rbreaves/kinto/HEAD/install/linux.sh || curl -fsSL https://raw.githubusercontent.com/rbreaves/kinto/HEAD/install/linux.sh)"
