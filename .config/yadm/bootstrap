#!/bin/sh
# Bootstrapping script for arch linux installed with the archinstall script using kde-plasma as DE and X11 windows.
# Install kde and nvidia using archinstall.

command_exists() {
    type "$1" &> /dev/null ;
}

install() {
    echo ">>> Installing $1"
    yay -S --noconfirm --needed --noprovides --cleanafter --nodiffmenu $1
}

install_all() {
    local -n arr=$1
    for P in "${arr[@]}"
    do
        install $P
    done
}

cd $HOME
echo ">>> Updating submodules"
yadm submodule update --recursive --init


# Install yay
if ! command_exists yay; then
    echo ">>> Installing yay"
    sudo pacman -S --noconfirm --needed git base-devel && git clone https://aur.archlinux.org/yay-bin.git && cd yay-bin && makepkg -si --noconfirm && cd $HOME && rm -rf yay-bin
fi
yay -Syu --noconfirm


# Install packages
terminal=(
    "kitty"
    "zsh"
    "antigen"
)
install_all terminal

cli_tools=(
    "ripgrep"
    "fd"
    "xclip"
    "github-cli"
)
install_all cli_tools

editor=(
    "neovim"
    "emacs"
)
install_all editor

fonts=(
    "nerd-fonts-source-code-pro"
)
install_all fonts

window=(
    "xorg"
)
install_all window

apps=(
    "phonon-qt5-vlc"
    "bitwarden"
    "pcloud-drive"
    "discord"
    "gimp"
)
install_all apps

vm=(
    "virtualbox-host-modules-arch"
    "virtualbox"
    "virtualbox-guest-iso"
)
install vm

programming=(
    "npm"
    "python-pip"
    "gcc"
)
install_all programming


# Setup doom-emacs
if [ ! -d "$HOME/.config/emacs" ]; then
    git clone https://github.com/hlissner/doom-emacs ~/.config/emacs
    ~/.config/emacs/bin/doom install
fi

# Setup VirtualBox
sudo modprobe vboxdrv
sudo usermod -aG vboxusers $USER

# Kinto
#
# echo "Installing kinto"
# # /bin/bash -c "$(wget -qO- https://raw.githubusercontent.com/rbreaves/kinto/HEAD/install/linux.sh || curl -fsSL https://raw.githubusercontent.com/rbreaves/kinto/HEAD/install/linux.sh)"
