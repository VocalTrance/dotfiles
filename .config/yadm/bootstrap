#!/bin/sh
# Requirements: $USER added to wheel group and NetworkManager.service enabled.

# Pull submodules
cd $HOME
echo ">>> Updating submodules"
yadm submodule update --recursive --init

# Install yay
if ! command_exists yay; then
    echo ">>> Installing yay"
    sudo pacman -S --noconfirm --needed git base-devel && git clone https://aur.archlinux.org/yay-bin.git && cd yay-bin && makepkg -si --noconfirm && cd $HOME && rm -rf yay-bin
fi
yay -Syu --noconfirm

base=(
    "kitty"
    "zsh"
    "neovim"
    "emacs-nativecomp"
    "xclip"
    "ripgrep"
    "fd"
    "neofetch"
)

window=(
    "xorg"
    "nvidia"
    "nvidia-utils"
    "nvidia-settings"
    "sddm"
    "plasma"
    "kde-applications"
    "onboard"
)

apps=(
    "bitwarden"
    "discord"
    "gimp"
    "phonon-qt5-vlc"
    "spotify-adblock"
)

vm=(
    "virtualbox-host-modules-arch"
    "virtualbox"
    "virtualbox-guest-iso"
)

programming=(
    "npm"
    "gcc"
    "cmake"
    "python-pip"
    "shellcheck"
    "mono"
)

writing=(
    "texlive-most"
    "zathura"
    "texlab"
)

banking=(
    "gnucash"
    "gnucash-docs"
    "perl-finance-quote"
)

packages=(
    ${base[@]}
    ${apps[@]}
    ${window[@]}
    ${vm[@]}
    ${programming[@]}
    ${writing[@]}
    ${banking[@]}
)

aur_packages=(
    "nerd-fonts-source-code-pro"
    "nerd-fonts-overpass"
    "nerd-fonts-jetbrains-mono"
    "github-cli"
    "antigen-git"
    "brave-bin"
    "pcloud-drive"
)

# Install packages
yay -S --noconfirm --needed --noprovides --cleanafter --nodiffmenu ${packages[@]}
yay -S --noconfirm --needed --noprovides --cleanafter --nodiffmenu ${aur_packages[@]}

# Enable services
sudo systemctl enable sddm

# Change shell
chsh

# Setup Doom Emacs
git clone https://github.com/hlissner/doom-emacs ~/.emacs.d
emacs --batch --eval "(progn (require 'org) (setq org-confirm-babel-evaluate nil) (org-babel-tangle-file \"~/.config/doom/config.org\"))"
doom install

# Setup VirtualBox
sudo modprobe vboxdrv
sudo usermod -aG vboxusers $USER

# Remove unnecessary dotfiles
cd $HOME && rm -rf .bash*

# Install npm modules
sudo npm install -g n

# Setup latex
cd $HOME && mkdir texmf && cd texmf && git clone https://github.com/tecosaur/BMC.git && texhash && sudo updmap-sys --enable Map=fontawesome5.map && cd $HOME
